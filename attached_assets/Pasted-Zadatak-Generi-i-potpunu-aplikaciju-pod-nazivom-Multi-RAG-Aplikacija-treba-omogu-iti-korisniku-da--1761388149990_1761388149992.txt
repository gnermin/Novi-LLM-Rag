Zadatak:
GeneriÅ¡i potpunu aplikaciju pod nazivom Multi-RAG.
Aplikacija treba omoguÄ‡iti korisniku da:

Uploaduje dokumente (PDF, DOCX, XLSX, CSV, JPG, PNG)

Obradi ih kroz multi-agentni AI pipeline

Spoji se na eksternu bazu i povuÄe podatke preko SQL upita (SQLIngestAgent)

SaÄuva sve u Postgres/pgvector

OmoguÄ‡i RAG pretragu i chat s citatima

Ima moderan, responzivan React+Tailwind frontend

ğŸ”§ Tehnologije

Backend: FastAPI (Python 3.11)

Baza: PostgreSQL 16 + pgvector + uuid-ossp

Queue/Async: Redis + RQ (worker pattern)

Frontend: React + TypeScript + Vite + Tailwind + Shadcn UI stil

Proxy: Nginx

Deployment: Docker Compose (sa 6 servisa)

ğŸ—ï¸ Struktura direktorija
multi-rag/
â”œâ”€ docker-compose.yml
â”œâ”€ .env.example
â”œâ”€ db/init/
â”‚  â”œâ”€ 00_init.sql
â”‚  â””â”€ 01_pgvector.sql
â”œâ”€ backend/
â”‚  â”œâ”€ Dockerfile
â”‚  â”œâ”€ requirements.txt
â”‚  â””â”€ app/
â”‚     â”œâ”€ main.py
â”‚     â”œâ”€ core/ (config.py, db.py, security.py)
â”‚     â”œâ”€ models/ (user.py, document.py, chunk.py, relation.py, external_source.py)
â”‚     â”œâ”€ schemas/ (auth.py, document.py, chat.py, ingest.py)
â”‚     â”œâ”€ api/ (routes_auth.py, routes_documents.py, routes_chat.py, routes_ingest.py)
â”‚     â”œâ”€ services/ (pipeline.py, search.py, rag_pipeline.py, embedding.py)
â”‚     â””â”€ agents/
â”‚        â”œâ”€ base.py, types.py
â”‚        â”œâ”€ mime_detect.py, layout.py, text_extract.py, ocr.py
â”‚        â”œâ”€ table.py, pii.py, chunking.py, relations.py
â”‚        â”œâ”€ image_extract.py, figure_classifier.py, caption.py
â”‚        â”œâ”€ embedding.py, indexing.py
â”‚        â””â”€ sql_ingest.py   â† ğŸ”¥ novi agent
â””â”€ frontend/
   â”œâ”€ Dockerfile
   â”œâ”€ index.html
   â”œâ”€ tailwind.config.ts
   â”œâ”€ postcss.config.js
   â”œâ”€ tsconfig.json
   â””â”€ src/
      â”œâ”€ main.tsx
      â”œâ”€ styles.css
      â”œâ”€ lib/{api.ts, utils.ts}
      â”œâ”€ ui/AppLayout.tsx
      â”œâ”€ pages/{Home.tsx, Documents.tsx, Chat.tsx, Settings.tsx}
      â””â”€ components/{FileDropzone.tsx, AgentTrace.tsx, ChatWindow.tsx}

ğŸ§© Backend â€“ Agentni pipeline

Osnovni agenti (redoslijed):

MimeDetectAgent â€“ detekcija tipa fajla

LayoutAgent â€“ analiza PDF strukture

ImageExtractAgent â€“ izvlaÄenje slika

FigureClassifierAgent â€“ dijagram vs. foto

CaptionAgent â€“ prepoznavanje natpisa

TextExtractAgent â€“ ekstrakcija teksta

OCRAgent â€“ prepoznavanje teksta iz slika

TableAgent â€“ tabele (Camelot/pdfplumber/pandas)

PIIComplianceAgent â€“ maskiranje liÄnih podataka

ChunkingAgent â€“ segmentacija teksta

RelationAgent â€“ veze tekstâ†”slikaâ†”tabela

EmbeddingAgent â€“ embedding (OpenAI/lokalni)

IndexingAgent â€“ indeksiranje u pgvector

SQLIngestAgent (ğŸ”¥ NOVO) â€“ konektuje se na eksternu bazu, izvrÅ¡ava SELECT,
pretvara redove u chunkove i sprema u lokalni Postgres

ğŸ§  Novi agent: SQLIngestAgent

Funkcija:

Spaja se na EXTERNAL_DB_URL (npr. DB2, MySQL, MSSQL, Postgres)

IzvrÅ¡ava SELECT upit (SQL_INGEST_QUERY iz .env ili iz API poziva)

Rezultate serijalizuje po redovima u document_chunks

Kreira novi zapis u documents tabeli (filename="SQL:source")

PokreÄ‡e EmbeddingAgent i IndexingAgent za RAG integraciju

ENV:

EXTERNAL_DB_URL=postgresql+psycopg://user:pass@remote_host/db
SQL_INGEST_QUERY=SELECT * FROM public.sample LIMIT 100
SQL_INGEST_BATCH_SIZE=500


API:

POST /ingest/sql
Body: { "source_name": "DWH_Customers", "query": "SELECT * FROM customers LIMIT 200" }

ğŸ—„ï¸ Baza i tabele

users (id, email, password_hash)

documents (id, filename, status, created_at, created_by)

document_chunks (id, document_id, chunk_index, content, metadata jsonb, embedding vector(1536))

document_relations (id, document_id, source_ref, target_ref, type, score)

external_sources (id, name, query, created_at)

ingest_jobs (id, document_id, status, logs jsonb, error text)

Statusi: pending â†’ processing â†’ ready | error

Indexi:

ivfflat na embedding vector_cosine_ops

GIN index na to_tsvector('simple', content)

ğŸ” Pretraga i RAG chat

/search â†’ BM25 + pgvector hibrid

/chat â†’ prima {query, top_k}; vraÄ‡a {answer, citations}

Citati se veÅ¾u na document_chunks.id

âš™ï¸ Pipeline scenariji
Scenario	Ulaz	Agenti	Opis
A	Tekstualni PDF/DOCX	Mimeâ†’Layoutâ†’TextExtractâ†’Chunkâ†’Embeddingâ†’Index	KlasiÄan dokument
B	Skenirani PDF	Mimeâ†’Layoutâ†’ImageExtractâ†’OCRâ†’Chunkâ†’Embeddingâ†’Index	OCR dokument
C	PDF s tabelama/slikama	Mimeâ†’Layoutâ†’TextExtractâ†’Tableâ†’ImageExtractâ†’Relationâ†’Chunkâ†’Embeddingâ†’Index	Strukturalno bogat dokument
D	Samo slike	Mimeâ†’OCRâ†’Chunkâ†’Embeddingâ†’Index	Sken/Foto
E	Excel/CSV	Mimeâ†’Tableâ†’Chunkâ†’Embeddingâ†’Index	TabliÄni
F (ğŸ”¥ NOVO)	SQL iz eksterne baze	SQLIngestâ†’Embeddingâ†’Index	Automatsko ubacivanje i RAG integracija
ğŸ” Sigurnost

JWT auth (signup/login)

RLS (RLS policy po user_id)

Upload limit 50 MB

Sanitizacija SQL upita â€“ samo SELECT

.env konfiguracija za agente:

EMBEDDINGS_PROVIDER=openai
EMBEDDINGS_DIM=1536
OCR_ENABLED=true
PIPELINE_MODE=full

ğŸ§° API rute

/auth/signup, /auth/login

/documents/upload

/documents, /documents/{id} (status + logovi)

/ingest/sql (SQLIngestAgent)

/chat, /search, /health

ğŸ–¥ï¸ Frontend (React + Vite + Tailwind)

Navigacija: Home | Documents | Chat | Settings

Stranice:

/ â€“ hero sekcija, opis sistema, CTA (â€Upload dokumentâ€œ / â€RAG chatâ€œ)

/documents â€“ Upload, lista dokumenata, status agenata (FileDropzone, AgentTrace)

/chat â€“ RAG Chat (ChatWindow)

/settings â€“ panel za SQL ingest (source_name, query â†’ POST /ingest/sql)

Komponente:

FileDropzone.tsx â€“ drag&drop upload

AgentTrace.tsx â€“ prikaz toka agenata, logova i saÅ¾etka (chunks/tables/relations/images)

ChatWindow.tsx â€“ chat s prikazom citata

AppLayout.tsx â€“ topbar + footer, moderan layout

api.ts â€“ API pozivi (/documents, /chat, /ingest/sql)

Stil:

Tailwind + utility klase (rounded-2xl, shadow-sm, bg-gradient-to-b, text-slate-*)

MinimalistiÄki, moderan UI (Shadcn inspiracija)

Responsive grid, light theme

ğŸ³ Docker Compose

Servisi:

db       â†’  Postgres + pgvector
redis    â†’  Queue backend
backend  â†’  FastAPI
worker   â†’  RQ Worker
frontend â†’  React (Vite)
nginx    â†’  Reverse proxy


Expose:

5173 â†’ frontend

8000 â†’ API

6379 â†’ Redis

80/443 â†’ Nginx

backend Äekanje health-checka na db;
worker poll-uje Redis za tasks (asinkrono izvrÅ¡avanje agenata).

ğŸ§ª Kriteriji uspjeha

âœ… Docker Compose radi iz prve (docker compose up --build)
âœ… Upload dokumenta pokreÄ‡e pipeline i prikazuje log agenata
âœ… /ingest/sql dodaje SQL dataset u RAG bazu
âœ… Chat vraÄ‡a odgovore + citate iz svih izvora (dokument i SQL)
âœ… Frontend je moderan, jasan i potpuno responzivan

ğŸ“› Projekt

Naziv: Multi-RAG â€” Multi-Agent Retrieval-Augmented Generation System
Autor: Nermin Goran â€“ AI/IoT Systems Architect
Opis: Sve-u-jednom RAG sistem za dokumente i SQL izvore, s modularnim agentima i modernim frontendom.